#!/usr/bin/env ruby

if ARGV.size == 0
  puts '
Usage: controller [ boot | quit ]
       controller [ start | status | stop | restart | log ] [worker]

Example:
  % controller boot    # start bluepilld and jobs
  % controller status  # check on status of jobs
  % controller log dor_accessionWF_descriptive-metadata # view log for worker
  % controller stop    # stop jobs
  % controller quit    # stop bluepilld
'
  exit -1
end

ENV['ROBOT_ENVIRONMENT'] ||= 'development'

cmd = "bluepill --no-privileged"
cmd << " --base-dir #{ENV['BLUEPILL_BASE_DIR'] || File.expand_path('run/bluepill')}"
cmd << " --logfile #{ENV['BLUEPILL_LOGFILE'] || File.expand_path('log/bluepill.log')}"

if ARGV[0] == 'boot' 
  system "#{cmd} load config/environments/bluepill_#{ENV['ROBOT_ENVIRONMENT']}.rb"
else
  system "#{cmd} #{ARGV.join(' ')}"
end
